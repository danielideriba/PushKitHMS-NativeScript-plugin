"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const path_1 = require("path");
const fs = require("fs");
function default_1(tree) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const cwd = process.cwd();
        // update build-finish to support non-scoped npm names
        const buildFinishPath = path_1.join(cwd, 'tools', 'scripts', 'build-finish.ts');
        const buildFinishUpdatePath = path_1.join(cwd, `node_modules/@nativescript/plugin-tools/src/migrations/update-2-1-0/_files/build-finish`);
        const buildFinish = fs.readFileSync(buildFinishPath, {
            encoding: 'utf-8',
        });
        const buildFinishUpdate = fs.readFileSync(buildFinishUpdatePath, {
            encoding: 'utf-8',
        });
        if (buildFinish && buildFinishPath) {
            tree.write('tools/scripts/build-finish.ts', buildFinishUpdate);
        }
        // update jest.config to latest config
        const jestConfigPath = path_1.join(cwd, 'jest.config.js');
        const jestConfigUpdatePath = path_1.join(cwd, `node_modules/@nativescript/plugin-tools/src/migrations/update-2-1-0/_files/jest.config`);
        const jestConfig = fs.readFileSync(jestConfigPath, {
            encoding: 'utf-8',
        });
        const jestConfigUpdate = fs.readFileSync(jestConfigUpdatePath, {
            encoding: 'utf-8',
        });
        if (jestConfig && jestConfigUpdate) {
            tree.write('jest.config.js', jestConfigUpdate);
        }
        devkit_1.updateJson(tree, 'package.json', (json) => {
            json.devDependencies['typescript'] = '4.3.5';
            return json;
        });
        devkit_1.updateJson(tree, 'workspace.json', (json) => {
            json.projects = json.projects || {};
            json.projects['all'].root = '';
            json.projects['all'].sourceRoot = '';
            json.projects['all'].projectType = 'application';
            return json;
        });
    });
}
exports.default = default_1;
//# sourceMappingURL=update-2-1-0.js.map